<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pipeline操作 &mdash; EasyMLOps 0.1 文档</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/translations.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="生产部署" href="cap8_deploy.html" />
    <link rel="prev" title="自定义pipe模块" href="cap6_pipe.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            EasyMLOps
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">EasyMLOps使用文档</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="cap1_introduce.html">简介&amp;安装&amp;反馈</a></li>
<li class="toctree-l1"><a class="reference internal" href="cap2_table.html">Table任务</a></li>
<li class="toctree-l1"><a class="reference internal" href="cap3_nlp.html">NLP任务</a></li>
<li class="toctree-l1"><a class="reference internal" href="cap4_mem_opt.html">内存优化</a></li>
<li class="toctree-l1"><a class="reference internal" href="cap5_persistence.html">持久化</a></li>
<li class="toctree-l1"><a class="reference internal" href="cap6_pipe.html">自定义pipe模块</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">pipeline操作</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#pipelinepipe">pipeline也是pipe</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipepipeline">聚合pipe为pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">pipeline运行到指定位置</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#indexint">index为int的情况</a></li>
<li class="toctree-l3"><a class="reference internal" href="#indexlisttuple">index为list或tuple</a></li>
<li class="toctree-l3"><a class="reference internal" href="#indexstr">index为str</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pipe">获取指定的pipe模块</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">index为int</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">index为str</a></li>
<li class="toctree-l3"><a class="reference internal" href="#indextuplelist">index为tuple或list</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id4">pipeline的切片式调用</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cap8_deploy.html">生产部署</a></li>
<li class="toctree-l1"><a class="reference internal" href="cap9_storage.html">特征存储&amp;监控&amp;分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="easymlops.html">API Refrence(Version=0.1)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">EasyMLOps</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">pipeline操作</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/cap7_pipeline.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pipeline">
<h1>pipeline操作<a class="headerlink" href="#pipeline" title="此标题的永久链接">¶</a></h1>
<p>pipeline是承载pipe的流程工具，它具有<strong>聚合pipe</strong>的功能，也具有<strong>拆散pipe</strong>的功能，由于建模流程的灵活性，经常要在某些pipe模块中流转调试优化，所以pipeline设计的要求是：<strong>聚</strong>是基础，<strong>拆</strong>是核心，下面依次介绍相应功能</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#准备数据</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s2">&quot;../../&quot;</span><span class="p">)</span><span class="c1">#与easymlops同级目录</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./data/demo.csv&quot;</span><span class="p">)</span>
<span class="n">x_train</span><span class="o">=</span><span class="n">data</span><span class="p">[:</span><span class="mi">500</span><span class="p">]</span>
<span class="n">x_test</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="mi">500</span><span class="p">:]</span>
<span class="n">y_train</span><span class="o">=</span><span class="n">x_train</span><span class="p">[</span><span class="s2">&quot;Survived&quot;</span><span class="p">]</span>
<span class="n">y_test</span><span class="o">=</span><span class="n">x_test</span><span class="p">[</span><span class="s2">&quot;Survived&quot;</span><span class="p">]</span>
<span class="k">del</span> <span class="n">x_train</span><span class="p">[</span><span class="s2">&quot;Survived&quot;</span><span class="p">]</span>
<span class="k">del</span> <span class="n">x_test</span><span class="p">[</span><span class="s2">&quot;Survived&quot;</span><span class="p">]</span>
</pre></div>
</div>
<section id="pipelinepipe">
<h2>pipeline也是pipe<a class="headerlink" href="#pipelinepipe" title="此标题的永久链接">¶</a></h2>
<p>pipeline继承了pipe的基础功能，所以这意味这pipeline也可以当着pipe用，这样pipeline就可以再嵌入pipeline</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">easymlops</span> <span class="kn">import</span> <span class="n">NLPPipeline</span><span class="p">,</span><span class="n">TablePipeLine</span>
<span class="kn">from</span> <span class="nn">easymlops.table.preprocessing</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">easymlops.table.ensemble</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">easymlops.table.encoding</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">easymlops.nlp.preprocessing</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">easymlops.nlp.representation</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">easymlops.table.perfopt</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">easymlops.table.classification</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">easymlops.table.decomposition</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">easymlops.table.extend</span> <span class="kn">import</span> <span class="n">Normalization</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nlp</span><span class="o">=</span><span class="n">NLPPipeline</span><span class="p">()</span>
<span class="n">nlp</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">FixInput</span><span class="p">())</span>\
   <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">TablePipeLine</span><span class="p">()</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">FillNa</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span><span class="s2">&quot;Sex&quot;</span><span class="p">]))</span>
                        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">SelectCols</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span><span class="s2">&quot;Sex&quot;</span><span class="p">]))</span>
                        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">Lower</span><span class="p">()))</span>\
   <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">Parallel</span><span class="p">([</span><span class="n">LsiTopicModel</span><span class="p">(</span><span class="n">num_topics</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
                   <span class="n">Word2VecModel</span><span class="p">(</span><span class="n">embedding_size</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
                   <span class="n">TablePipeLine</span><span class="p">()</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">RemovePunctuation</span><span class="p">())</span>\
                                  <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">TFIDF</span><span class="p">())]))</span>\
   <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">DropCols</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span><span class="s2">&quot;Sex&quot;</span><span class="p">]))</span>\
   <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">LGBMClassification</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span><span class="n">support_sparse_input</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">native_init_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span> <span class="n">native_fit_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;num_boost_round&quot;</span><span class="p">:</span> <span class="mi">128</span><span class="p">}))</span>

<span class="n">x_test_new</span><span class="o">=</span><span class="n">nlp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x_test_new</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|     |        0 |         1 |
|----:|---------:|----------:|
| 500 | 0.919121 | 0.0808785 |
| 501 | 0.189551 | 0.810449  |
| 502 | 0.189551 | 0.810449  |
| 503 | 0.255328 | 0.744672  |
| 504 | 0.264882 | 0.735118  |
</pre></div>
</div>
</section>
<section id="pipepipeline">
<h2>聚合pipe为pipeline<a class="headerlink" href="#pipepipeline" title="此标题的永久链接">¶</a></h2>
<p>上面构建pipeline的方式与我们通常建模流程相反，实际的建模时分别训练构建好各个pipe模块（还会反复在某些模块迭代优化多轮）后再进行组合，如下</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fillna_pipe</span><span class="o">=</span><span class="n">TablePipeLine</span><span class="p">()</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">FixInput</span><span class="p">())</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">FillNa</span><span class="p">())</span>
<span class="n">x_train_new</span><span class="o">=</span><span class="n">fillna_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x_train_new</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|    |   PassengerId |   Pclass | Name                                                | Sex    |   Age |   SibSp |   Parch | Ticket           |     Fare | Cabin   | Embarked   |
|---:|--------------:|---------:|:----------------------------------------------------|:-------|------:|--------:|--------:|:-----------------|---------:|:--------|:-----------|
|  0 |             1 |        3 | Braund, Mr. Owen Harris                             | male   |    22 |       1 |       0 | A/5 21171        |  7.25    | nan     | S          |
|  1 |             2 |        1 | Cumings, Mrs. John Bradley (Florence Briggs Thayer) | female |    38 |       1 |       0 | PC 17599         | 71.3125  | C85     | C          |
|  2 |             3 |        3 | Heikkinen, Miss. Laina                              | female |    26 |       0 |       0 | STON/O2. 3101282 |  7.92578 | nan     | S          |
|  3 |             4 |        1 | Futrelle, Mrs. Jacques Heath (Lily May Peel)        | female |    35 |       1 |       0 | 113803           | 53.0938  | C123    | S          |
|  4 |             5 |        3 | Allen, Mr. William Henry                            | male   |    35 |       0 |       0 | 373450           |  8.04688 | nan     | S          |
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_onehot_encoding</span><span class="o">=</span><span class="n">OneHotEncoding</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Pclass&quot;</span><span class="p">,</span><span class="s2">&quot;Sex&quot;</span><span class="p">],</span><span class="n">drop_col</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">x_train_new</span><span class="o">=</span><span class="n">pipe_onehot_encoding</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train_new</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_train_new</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x_train_new</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|    |   PassengerId |   Pclass | Name                                                | Sex    |   Age |   SibSp |   Parch | Ticket           |     Fare | Cabin   | Embarked   |   Pclass_3 |   Pclass_1 |   Pclass_2 |   Sex_male |   Sex_female |
|---:|--------------:|---------:|:----------------------------------------------------|:-------|------:|--------:|--------:|:-----------------|---------:|:--------|:-----------|-----------:|-----------:|-----------:|-----------:|-------------:|
|  0 |             1 |        3 | Braund, Mr. Owen Harris                             | male   |    22 |       1 |       0 | A/5 21171        |  7.25    | nan     | S          |          1 |          0 |          0 |          1 |            0 |
|  1 |             2 |        1 | Cumings, Mrs. John Bradley (Florence Briggs Thayer) | female |    38 |       1 |       0 | PC 17599         | 71.3125  | C85     | C          |          0 |          1 |          0 |          0 |            1 |
|  2 |             3 |        3 | Heikkinen, Miss. Laina                              | female |    26 |       0 |       0 | STON/O2. 3101282 |  7.92578 | nan     | S          |          1 |          0 |          0 |          0 |            1 |
|  3 |             4 |        1 | Futrelle, Mrs. Jacques Heath (Lily May Peel)        | female |    35 |       1 |       0 | 113803           | 53.0938  | C123    | S          |          0 |          1 |          0 |          0 |            1 |
|  4 |             5 |        3 | Allen, Mr. William Henry                            | male   |    35 |       0 |       0 | 373450           |  8.04688 | nan     | S          |          1 |          0 |          0 |          1 |            0 |
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_label_encoding</span><span class="o">=</span><span class="n">LabelEncoding</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Sex&quot;</span><span class="p">,</span><span class="s2">&quot;Pclass&quot;</span><span class="p">])</span>
<span class="n">x_train_new</span><span class="o">=</span><span class="n">pipe_label_encoding</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train_new</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_train_new</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x_train_new</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|    |   PassengerId |   Pclass | Name                                                |   Sex |   Age |   SibSp |   Parch | Ticket           |     Fare | Cabin   | Embarked   |   Pclass_3 |   Pclass_1 |   Pclass_2 |   Sex_male |   Sex_female |
|---:|--------------:|---------:|:----------------------------------------------------|------:|------:|--------:|--------:|:-----------------|---------:|:--------|:-----------|-----------:|-----------:|-----------:|-----------:|-------------:|
|  0 |             1 |        1 | Braund, Mr. Owen Harris                             |     1 |    22 |       1 |       0 | A/5 21171        |  7.25    | nan     | S          |          1 |          0 |          0 |          1 |            0 |
|  1 |             2 |        2 | Cumings, Mrs. John Bradley (Florence Briggs Thayer) |     2 |    38 |       1 |       0 | PC 17599         | 71.3125  | C85     | C          |          0 |          1 |          0 |          0 |            1 |
|  2 |             3 |        1 | Heikkinen, Miss. Laina                              |     2 |    26 |       0 |       0 | STON/O2. 3101282 |  7.92578 | nan     | S          |          1 |          0 |          0 |          0 |            1 |
|  3 |             4 |        2 | Futrelle, Mrs. Jacques Heath (Lily May Peel)        |     2 |    35 |       1 |       0 | 113803           | 53.0938  | C123    | S          |          0 |          1 |          0 |          0 |            1 |
|  4 |             5 |        1 | Allen, Mr. William Henry                            |     1 |    35 |       0 |       0 | 373450           |  8.04688 | nan     | S          |          1 |          0 |          0 |          1 |            0 |
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_target_encoding</span><span class="o">=</span><span class="n">TargetEncoding</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span><span class="s2">&quot;Ticket&quot;</span><span class="p">,</span><span class="s2">&quot;Embarked&quot;</span><span class="p">,</span><span class="s2">&quot;Cabin&quot;</span><span class="p">],</span><span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">x_train_new</span><span class="o">=</span><span class="n">pipe_target_encoding</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train_new</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_train_new</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x_train_new</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|    |   PassengerId |   Pclass |   Name |   Sex |   Age |   SibSp |   Parch |   Ticket |     Fare |    Cabin |   Embarked |   Pclass_3 |   Pclass_1 |   Pclass_2 |   Sex_male |   Sex_female |
|---:|--------------:|---------:|-------:|------:|------:|--------:|--------:|---------:|---------:|---------:|-----------:|-----------:|-----------:|-----------:|-----------:|-------------:|
|  0 |             1 |        1 |      0 |     1 |    22 |       1 |       0 |      0   |  7.25    | 0.317829 |   0.334254 |          1 |          0 |          0 |          1 |            0 |
|  1 |             2 |        2 |      1 |     2 |    38 |       1 |       0 |      1   | 71.3125  | 1        |   0.521739 |          0 |          1 |          0 |          0 |            1 |
|  2 |             3 |        1 |      1 |     2 |    26 |       0 |       0 |      1   |  7.92578 | 0.317829 |   0.334254 |          1 |          0 |          0 |          0 |            1 |
|  3 |             4 |        2 |      1 |     2 |    35 |       1 |       0 |      0.5 | 53.0938  | 0.5      |   0.334254 |          0 |          1 |          0 |          0 |            1 |
|  4 |             5 |        1 |      0 |     1 |    35 |       0 |       0 |      0   |  8.04688 | 0.317829 |   0.334254 |          1 |          0 |          0 |          1 |            0 |
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_normal</span><span class="o">=</span><span class="n">Normalizer</span><span class="p">()</span>
<span class="n">x_train_new</span><span class="o">=</span><span class="n">pipe_normal</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train_new</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_train_new</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x_train_new</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|    |   PassengerId |    Pclass |      Name |       Sex |        Age |     SibSp |   Parch |    Ticket |      Fare |     Cabin |   Embarked |   Pclass_3 |   Pclass_1 |   Pclass_2 |   Sex_male |   Sex_female |
|---:|--------------:|----------:|----------:|----------:|-----------:|----------:|--------:|----------:|----------:|----------:|-----------:|-----------:|-----------:|-----------:|-----------:|-------------:|
|  0 |      -1.72859 | -0.810644 | -0.792884 | -0.766356 | -0.0710908 |  0.369594 | -0.4875 | -0.83866  | -0.515811 | -0.287586 |  -0.597846 |   0.890008 |  -0.549621 |   -0.51558 |   0.766356 |    -0.766356 |
|  1 |      -1.72166 |  0.432675 |  1.26122  |  1.30488  |  0.84106   |  0.369594 | -0.4875 |  1.33403  |  0.831116 |  2.59023  |   1.56826  |  -1.12359  |   1.81944  |   -0.51558 |  -1.30488  |     1.30488  |
|  2 |      -1.71473 | -0.810644 |  1.26122  |  1.30488  |  0.156947  | -0.497998 | -0.4875 |  1.33403  | -0.501603 | -0.287586 |  -0.597846 |   0.890008 |  -0.549621 |   -0.51558 |  -1.30488  |     1.30488  |
|  3 |      -1.70781 |  0.432675 |  1.26122  |  1.30488  |  0.670032  |  0.369594 | -0.4875 |  0.247687 |  0.448063 |  0.480923 |  -0.597846 |  -1.12359  |   1.81944  |   -0.51558 |  -1.30488  |     1.30488  |
|  4 |      -1.70088 | -0.810644 | -0.792884 | -0.766356 |  0.670032  | -0.497998 | -0.4875 | -0.83866  | -0.499057 | -0.287586 |  -0.597846 |   0.890008 |  -0.549621 |   -0.51558 |   0.766356 |    -0.766356 |
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_pca</span><span class="o">=</span><span class="n">PCADecomposition</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">x_train_new</span><span class="o">=</span><span class="n">pipe_pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train_new</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_train_new</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x_train_new</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|    |        0 |         1 |          2 |          3 |          4 |        5 |        6 |         7 |
|---:|---------:|----------:|-----------:|-----------:|-----------:|---------:|---------:|----------:|
|  0 | -2.33692 |  0.710067 |  0.0803019 |  0.0746554 |  0.0515367 | 1.25277  | 1.07024  | -0.624323 |
|  1 |  4.13372 | -0.15474  |  1.78063   | -0.908822  |  0.0571593 | 1.84565  | 0.755661 | -0.561293 |
|  2 |  1.65117 |  2.18103  | -1.10575   | -0.975744  | -0.441426  | 0.820884 | 1.82729  | -0.175748 |
|  3 |  2.83835 | -0.176422 |  0.638332  |  0.0833258 | -1.11821   | 1.18948  | 1.34569  | -1.29006  |
|  4 | -2.31382 |  0.326691 |  0.0522898 | -0.487427  | -0.461197  | 1.09001  | 1.5257   | -0.2117   |
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline_lr</span><span class="o">=</span><span class="n">TablePipeLine</span><span class="p">()</span>
<span class="n">pipeline_lr</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">LogisticRegressionClassification</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">))</span>\
           <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">Normalization</span><span class="p">())</span>

<span class="n">x_train_new</span><span class="o">=</span><span class="n">pipeline_lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train_new</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_train_new</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x_train_new</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|    |     0 |     1 |
|---:|------:|------:|
|  0 | 50.03 | 49.97 |
|  1 | 41.8  | 58.2  |
|  2 | 41.81 | 58.19 |
|  3 | 41.9  | 58.1  |
|  4 | 50.03 | 49.97 |
</pre></div>
</div>
<p>最后再新建一个pipeline取组合前面的pipe模块，<strong>注意，由于各pipe已经fit好了，组合后的pipeline不要再次fit，只需运行transform/transform_single等其他函数就好</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline_combine</span><span class="o">=</span><span class="n">TablePipeLine</span><span class="p">()</span>
<span class="n">pipeline_combine</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">fillna_pipe</span><span class="p">)</span>\
                <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pipe_onehot_encoding</span><span class="p">)</span>\
                <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pipe_label_encoding</span><span class="p">)</span>\
                <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pipe_target_encoding</span><span class="p">)</span>\
                <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pipe_normal</span><span class="p">)</span>\
                <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pipe_pca</span><span class="p">)</span>\
                <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pipeline_lr</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;easymlops.table.core.pipeline_object.TablePipeLine at 0x13aadde1bc8&gt;
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">pipeline_combine</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|     |     0 |     1 |
|----:|------:|------:|
| 500 | 50.02 | 49.98 |
| 501 | 49.9  | 50.1  |
| 502 | 49.84 | 50.16 |
| 503 | 49.95 | 50.05 |
| 504 | 48.35 | 51.65 |
</pre></div>
</div>
</section>
<section id="id1">
<h2>pipeline运行到指定位置<a class="headerlink" href="#id1" title="此标题的永久链接">¶</a></h2>
<p>有时候需要定位数据从最初运行到指定pipe模块的输出结果，这里提供了三种方式：</p>
<ul class="simple">
<li><p>index是int，运行到最外层指定的那一层</p></li>
<li><p>index是str, 运行到指定<code class="docutils literal notranslate"><span class="pre">name</span></code>的那个pipe</p></li>
<li><p>index是list或tuple，运行到指定嵌入层的pipe</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">table</span><span class="o">=</span><span class="n">TablePipeLine</span><span class="p">()</span>
<span class="n">table</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">FixInput</span><span class="p">())</span>\
  <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">FillNa</span><span class="p">())</span>\
  <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">Parallel</span><span class="p">([</span><span class="n">OneHotEncoding</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Pclass&quot;</span><span class="p">,</span><span class="s2">&quot;Sex&quot;</span><span class="p">],</span><span class="n">drop_col</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                 <span class="n">TablePipeLine</span><span class="p">()</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">TargetEncoding</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Embarked&quot;</span><span class="p">,</span><span class="s2">&quot;Cabin&quot;</span><span class="p">],</span><span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;target_encoding&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">FillNa</span><span class="p">()),</span>
                 <span class="n">WOEEncoding</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Sex&quot;</span><span class="p">,</span><span class="s2">&quot;Pclass&quot;</span><span class="p">],</span><span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">),</span>
                 <span class="n">TablePipeLine</span><span class="p">()</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">LabelEncoding</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span><span class="s2">&quot;Ticket&quot;</span><span class="p">]))</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">DropCols</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span><span class="s2">&quot;Sex&quot;</span><span class="p">,</span><span class="s2">&quot;Ticket&quot;</span><span class="p">,</span><span class="s2">&quot;Cabin&quot;</span><span class="p">,</span><span class="s2">&quot;Emarked&quot;</span><span class="p">]))]))</span>\
  <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">TargetEncoding</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span><span class="s2">&quot;Cabin&quot;</span><span class="p">,</span><span class="s2">&quot;Embarked&quot;</span><span class="p">,</span><span class="s2">&quot;Ticket&quot;</span><span class="p">],</span><span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">))</span>\
  <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">FillNa</span><span class="p">())</span>\
  <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">Normalizer</span><span class="p">())</span>\
  <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">PCADecomposition</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">8</span><span class="p">))</span>

<span class="n">x_test_new</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x_test_new</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|     |          0 |          1 |         2 |         3 |         4 |        5 |        6 |          7 |
|----:|-----------:|-----------:|----------:|----------:|----------:|---------:|---------:|-----------:|
| 500 | -2.31036   | -0.0928624 | -0.19398  |  0.511277 |  0.202237 | -1.86472 | -0.24938 | -0.255635  |
| 501 |  0.180246  | -1.91993   | -0.315418 |  1.02128  | -1.91574  | -1.62147 | -1.47288 |  0.604476  |
| 502 |  0.115275  | -2.264     | -0.104098 |  1.12641  | -1.47905  | -1.51371 | -2.14166 | -0.0441479 |
| 503 | -0.0202802 | -1.64604   | -0.728745 | -0.034924 | -2.07495  | -2.24773 |  0.12019 | -0.132674  |
| 504 |  2.47437   |  0.881527  |  0.045653 | -0.240732 | -1.78536  | -1.93257 | -1.00486 | -1.33923   |
</pre></div>
</div>
<section id="indexint">
<h3>index为int的情况<a class="headerlink" href="#indexint" title="此标题的永久链接">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#查看第1层的数据</span>
<span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span><span class="n">run_to_layer</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|     |   PassengerId |   Pclass | Name                           | Sex    |   Age |   SibSp |   Parch |   Ticket |     Fare | Cabin   | Embarked   |
|----:|--------------:|---------:|:-------------------------------|:-------|------:|--------:|--------:|---------:|---------:|:--------|:-----------|
| 500 |           501 |        3 | Calic, Mr. Petar               | male   |    17 |       0 |       0 |   315086 |  8.66406 | nan     | S          |
| 501 |           502 |        3 | Canavan, Miss. Mary            | female |    21 |       0 |       0 |   364846 |  7.75    | nan     | Q          |
| 502 |           503 |        3 | O&#39;Sullivan, Miss. Bridget Mary | female |     0 |       0 |       0 |   330909 |  7.62891 | nan     | Q          |
| 503 |           504 |        3 | Laitinen, Miss. Kristina Sofia | female |    37 |       0 |       0 |     4135 |  9.58594 | nan     | S          |
| 504 |           505 |        1 | Maioni, Miss. Roberta          | female |    16 |       0 |       0 |   110152 | 86.5     | B79     | S          |
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#查看第2层的数据</span>
<span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span><span class="n">run_to_layer</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|     |   Pclass_3 |   Pclass_1 |   Pclass_2 |   Sex_male |   Sex_female | Name                           |      Sex |   Ticket | Cabin   |   PassengerId |   Pclass |   Age |   SibSp |   Parch |     Fare | Embarked   |
|----:|-----------:|-----------:|-----------:|-----------:|-------------:|:-------------------------------|---------:|---------:|:--------|--------------:|---------:|------:|--------:|--------:|---------:|:-----------|
| 500 |          1 |          0 |          0 |          1 |            0 | Calic, Mr. Petar               |  1.11138 |   315086 | nan     |           501 |        3 |    17 |       0 |       0 |  8.66406 | S          |
| 501 |          1 |          0 |          0 |          0 |            1 | Canavan, Miss. Mary            | -1.56999 |   364846 | nan     |           502 |        3 |    21 |       0 |       0 |  7.75    | Q          |
| 502 |          1 |          0 |          0 |          0 |            1 | O&#39;Sullivan, Miss. Bridget Mary | -1.56999 |   330909 | nan     |           503 |        3 |     0 |       0 |       0 |  7.62891 | Q          |
| 503 |          1 |          0 |          0 |          0 |            1 | Laitinen, Miss. Kristina Sofia | -1.56999 |     4135 | nan     |           504 |        3 |    37 |       0 |       0 |  9.58594 | S          |
| 504 |          0 |          1 |          0 |          0 |            1 | Maioni, Miss. Roberta          | -1.56999 |   110152 | B79     |           505 |        1 |    16 |       0 |       0 | 86.5     | S          |
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#查看倒数第3层的数据</span>
<span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span><span class="n">run_to_layer</span><span class="o">=-</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|     |   Pclass_3 |   Pclass_1 |   Pclass_2 |   Sex_male |   Sex_female |   Name |      Sex |   Ticket |    Cabin |   PassengerId |   Pclass |   Age |   SibSp |   Parch |     Fare |   Embarked |
|----:|-----------:|-----------:|-----------:|-----------:|-------------:|-------:|---------:|---------:|---------:|--------------:|---------:|------:|--------:|--------:|---------:|-----------:|
| 500 |          1 |          0 |          0 |          1 |            0 |      0 |  1.11138 |        0 | 0.317829 |           501 |        3 |    17 |       0 |       0 |  8.66406 |   0.334254 |
| 501 |          1 |          0 |          0 |          0 |            1 |      0 | -1.56999 |        0 | 0.317829 |           502 |        3 |    21 |       0 |       0 |  7.75    |   0.511111 |
| 502 |          1 |          0 |          0 |          0 |            1 |      0 | -1.56999 |        0 | 0.317829 |           503 |        3 |     0 |       0 |       0 |  7.62891 |   0.511111 |
| 503 |          1 |          0 |          0 |          0 |            1 |      0 | -1.56999 |        0 | 0.317829 |           504 |        3 |    37 |       0 |       0 |  9.58594 |   0.334254 |
| 504 |          0 |          1 |          0 |          0 |            1 |      0 | -1.56999 |        1 | 0        |           505 |        1 |    16 |       0 |       0 | 86.5     |   0.334254 |
</pre></div>
</div>
</section>
<section id="indexlisttuple">
<h3>index为list或tuple<a class="headerlink" href="#indexlisttuple" title="此标题的永久链接">¶</a></h3>
<p>嵌套层的范围:将run_to_layer设置为list结构，分别指定逐层的index</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#查看第2层(Parallel)的第0层(OneHotEncoding)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span><span class="n">run_to_layer</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|     |   PassengerId |   Pclass | Name                           | Sex    |   Age |   SibSp |   Parch |   Ticket |     Fare | Cabin   | Embarked   |   Pclass_3 |   Pclass_1 |   Pclass_2 |   Sex_male |   Sex_female |
|----:|--------------:|---------:|:-------------------------------|:-------|------:|--------:|--------:|---------:|---------:|:--------|:-----------|-----------:|-----------:|-----------:|-----------:|-------------:|
| 500 |           501 |        3 | Calic, Mr. Petar               | male   |    17 |       0 |       0 |   315086 |  8.66406 | nan     | S          |          1 |          0 |          0 |          1 |            0 |
| 501 |           502 |        3 | Canavan, Miss. Mary            | female |    21 |       0 |       0 |   364846 |  7.75    | nan     | Q          |          1 |          0 |          0 |          0 |            1 |
| 502 |           503 |        3 | O&#39;Sullivan, Miss. Bridget Mary | female |     0 |       0 |       0 |   330909 |  7.62891 | nan     | Q          |          1 |          0 |          0 |          0 |            1 |
| 503 |           504 |        3 | Laitinen, Miss. Kristina Sofia | female |    37 |       0 |       0 |     4135 |  9.58594 | nan     | S          |          1 |          0 |          0 |          0 |            1 |
| 504 |           505 |        1 | Maioni, Miss. Roberta          | female |    16 |       0 |       0 |   110152 | 86.5     | B79     | S          |          0 |          1 |          0 |          0 |            1 |
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#运行到第2层(Parallel)的第1层(TablePipeLine)的第0层(TargetEncoding)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span><span class="n">run_to_layer</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|     |   PassengerId |   Pclass | Name                           | Sex    |   Age |   SibSp |   Parch |   Ticket |     Fare |    Cabin |   Embarked |
|----:|--------------:|---------:|:-------------------------------|:-------|------:|--------:|--------:|---------:|---------:|---------:|-----------:|
| 500 |           501 |        3 | Calic, Mr. Petar               | male   |    17 |       0 |       0 |   315086 |  8.66406 | 0.317829 |   0.334254 |
| 501 |           502 |        3 | Canavan, Miss. Mary            | female |    21 |       0 |       0 |   364846 |  7.75    | 0.317829 |   0.511111 |
| 502 |           503 |        3 | O&#39;Sullivan, Miss. Bridget Mary | female |     0 |       0 |       0 |   330909 |  7.62891 | 0.317829 |   0.511111 |
| 503 |           504 |        3 | Laitinen, Miss. Kristina Sofia | female |    37 |       0 |       0 |     4135 |  9.58594 | 0.317829 |   0.334254 |
| 504 |           505 |        1 | Maioni, Miss. Roberta          | female |    16 |       0 |       0 |   110152 | 86.5     | 0        |   0.334254 |
</pre></div>
</div>
</section>
<section id="indexstr">
<h3>index为str<a class="headerlink" href="#indexstr" title="此标题的永久链接">¶</a></h3>
<p>命名访问:如果有对模块命名，可以通过指定名称的方式访问</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#查看到模块名为target_encoding的数据</span>
<span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span><span class="n">run_to_layer</span><span class="o">=</span><span class="s2">&quot;target_encoding&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|     |   PassengerId |   Pclass | Name                           | Sex    |   Age |   SibSp |   Parch |   Ticket |     Fare |    Cabin |   Embarked |
|----:|--------------:|---------:|:-------------------------------|:-------|------:|--------:|--------:|---------:|---------:|---------:|-----------:|
| 500 |           501 |        3 | Calic, Mr. Petar               | male   |    17 |       0 |       0 |   315086 |  8.66406 | 0.317829 |   0.334254 |
| 501 |           502 |        3 | Canavan, Miss. Mary            | female |    21 |       0 |       0 |   364846 |  7.75    | 0.317829 |   0.511111 |
| 502 |           503 |        3 | O&#39;Sullivan, Miss. Bridget Mary | female |     0 |       0 |       0 |   330909 |  7.62891 | 0.317829 |   0.511111 |
| 503 |           504 |        3 | Laitinen, Miss. Kristina Sofia | female |    37 |       0 |       0 |     4135 |  9.58594 | 0.317829 |   0.334254 |
| 504 |           505 |        1 | Maioni, Miss. Roberta          | female |    16 |       0 |       0 |   110152 | 86.5     | 0        |   0.334254 |
</pre></div>
</div>
</section>
</section>
<section id="pipe">
<h2>获取指定的pipe模块<a class="headerlink" href="#pipe" title="此标题的永久链接">¶</a></h2>
<p>有时候我们想获取指定pipe模块，并调用其函数方法,这里可以通过下标索引(从0开始),也可以通过name进行索引，与上面类似</p>
<section id="id2">
<h3>index为int<a class="headerlink" href="#id2" title="此标题的永久链接">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#获取-4层的target encoding</span>
<span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">show_detail</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|    | col   | bin_value                                      |   target_value |
|---:|:------|:-----------------------------------------------|---------------:|
|  0 | Name  | Abbott, Mrs. Stanton (Rosa Hunt)               |              1 |
|  1 | Name  | Abelson, Mr. Samuel                            |              0 |
|  2 | Name  | Adahl, Mr. Mauritz Nils Martin                 |              0 |
|  3 | Name  | Adams, Mr. John                                |              0 |
|  4 | Name  | Ahlin, Mrs. Johan (Johanna Persdotter Larsson) |              0 |
</pre></div>
</div>
</section>
<section id="id3">
<h3>index为str<a class="headerlink" href="#id3" title="此标题的永久链接">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#这里获取的是2-&gt;1层的target_encoding，因为它取名name=&quot;target_encoding&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;target_encoding&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">show_detail</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|    | col      | bin_value   |   target_value |
|---:|:---------|:------------|---------------:|
|  0 | Embarked | C           |       0.521739 |
|  1 | Embarked | Q           |       0.511111 |
|  2 | Embarked | S           |       0.334254 |
|  3 | Embarked | nan         |       1        |
|  4 | Cabin    | A14         |       0        |
</pre></div>
</div>
</section>
<section id="indextuplelist">
<h3>index为tuple或list<a class="headerlink" href="#indextuplelist" title="此标题的永久链接">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#获取2-&gt;2的woe encoding</span>
<span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">show_detail</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|    | col    | bin_value   |   bad_num |   bad_rate |   good_num |   good_rate |       woe |        iv |
|---:|:-------|:------------|----------:|-----------:|-----------:|------------:|----------:|----------:|
|  0 | Sex    | male        |        54 |   0.279793 |        261 |    0.850163 |  1.11138  | 0.633897  |
|  1 | Sex    | female      |       139 |   0.720207 |         46 |    0.149837 | -1.56999  | 0.895475  |
|  2 | Pclass | 3           |        78 |   0.404145 |        201 |    0.654723 |  0.482439 | 0.120889  |
|  3 | Pclass | 1           |        66 |   0.341969 |         50 |    0.162866 | -0.741789 | 0.132856  |
|  4 | Pclass | 2           |        49 |   0.253886 |         56 |    0.18241  | -0.330626 | 0.0236317 |
</pre></div>
</div>
</section>
</section>
<section id="id4">
<h2>pipeline的切片式调用<a class="headerlink" href="#id4" title="此标题的永久链接">¶</a></h2>
<p>可以通过切分的方式获取部分连续的pipe模块，并组装为Pipeline，这样可以更加方便灵活的获取中间结果</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">table</span><span class="o">=</span><span class="n">TablePipeLine</span><span class="p">()</span>
<span class="n">table</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">FixInput</span><span class="p">())</span>\
  <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">FillNa</span><span class="p">())</span>\
  <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">OneHotEncoding</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Pclass&quot;</span><span class="p">,</span><span class="s2">&quot;Sex&quot;</span><span class="p">],</span><span class="n">drop_col</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>\
  <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">WOEEncoding</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Sex&quot;</span><span class="p">,</span><span class="s2">&quot;Pclass&quot;</span><span class="p">],</span><span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">))</span>\
  <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">LabelEncoding</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span><span class="s2">&quot;Ticket&quot;</span><span class="p">]))</span>\
  <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">TargetEncoding</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Embarked&quot;</span><span class="p">,</span><span class="s2">&quot;Cabin&quot;</span><span class="p">],</span><span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;target_encoding&quot;</span><span class="p">))</span>\
  <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">FillNa</span><span class="p">())</span>\
  <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">Normalizer</span><span class="p">())</span>\
  <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">PCADecomposition</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">8</span><span class="p">))</span>

<span class="n">table</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;easymlops.table.core.pipeline_object.TablePipeLine at 0x13ab1ad0648&gt;
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#运行前3层</span>
<span class="n">step1</span><span class="o">=</span><span class="n">table</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_test</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">step1</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|     |   PassengerId |   Pclass | Name                           | Sex    |   Age |   SibSp |   Parch |   Ticket |     Fare | Cabin   | Embarked   |   Pclass_3 |   Pclass_1 |   Pclass_2 |   Sex_male |   Sex_female |
|----:|--------------:|---------:|:-------------------------------|:-------|------:|--------:|--------:|---------:|---------:|:--------|:-----------|-----------:|-----------:|-----------:|-----------:|-------------:|
| 500 |           501 |        3 | Calic, Mr. Petar               | male   |    17 |       0 |       0 |   315086 |  8.66406 | nan     | S          |          1 |          0 |          0 |          1 |            0 |
| 501 |           502 |        3 | Canavan, Miss. Mary            | female |    21 |       0 |       0 |   364846 |  7.75    | nan     | Q          |          1 |          0 |          0 |          0 |            1 |
| 502 |           503 |        3 | O&#39;Sullivan, Miss. Bridget Mary | female |     0 |       0 |       0 |   330909 |  7.62891 | nan     | Q          |          1 |          0 |          0 |          0 |            1 |
| 503 |           504 |        3 | Laitinen, Miss. Kristina Sofia | female |    37 |       0 |       0 |     4135 |  9.58594 | nan     | S          |          1 |          0 |          0 |          0 |            1 |
| 504 |           505 |        1 | Maioni, Miss. Roberta          | female |    16 |       0 |       0 |   110152 | 86.5     | B79     | S          |          0 |          1 |          0 |          0 |            1 |
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#运行中间3,4层</span>
<span class="n">step2</span><span class="o">=</span><span class="n">table</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">step1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">step2</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|     |   PassengerId |    Pclass |   Name |      Sex |   Age |   SibSp |   Parch |   Ticket |     Fare | Cabin   | Embarked   |   Pclass_3 |   Pclass_1 |   Pclass_2 |   Sex_male |   Sex_female |
|----:|--------------:|----------:|-------:|---------:|------:|--------:|--------:|---------:|---------:|:--------|:-----------|-----------:|-----------:|-----------:|-----------:|-------------:|
| 500 |           501 |  0.482439 |      0 |  1.11138 |    17 |       0 |       0 |        0 |  8.66406 | nan     | S          |          1 |          0 |          0 |          1 |            0 |
| 501 |           502 |  0.482439 |      0 | -1.56999 |    21 |       0 |       0 |        0 |  7.75    | nan     | Q          |          1 |          0 |          0 |          0 |            1 |
| 502 |           503 |  0.482439 |      0 | -1.56999 |     0 |       0 |       0 |        0 |  7.62891 | nan     | Q          |          1 |          0 |          0 |          0 |            1 |
| 503 |           504 |  0.482439 |      0 | -1.56999 |    37 |       0 |       0 |        0 |  9.58594 | nan     | S          |          1 |          0 |          0 |          0 |            1 |
| 504 |           505 | -0.741789 |      0 | -1.56999 |    16 |       0 |       0 |      231 | 86.5     | B79     | S          |          0 |          1 |          0 |          0 |            1 |
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#运行5层及之后</span>
<span class="n">step3</span><span class="o">=</span><span class="n">table</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">step2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">step3</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|     |         0 |        1 |          2 |          3 |        4 |         5 |         6 |         7 |
|----:|----------:|---------:|-----------:|-----------:|---------:|----------:|----------:|----------:|
| 500 | -2.14842  | 0.307872 |  0.526932  |  0.0881118 | 0.324999 | -0.238535 | -0.432583 | -0.424289 |
| 501 |  0.212949 | 2.32202  | -1.28604   | -0.469809  | 1.53792  | -0.098157 |  0.775934 |  0.459946 |
| 502 |  0.053812 | 2.543    | -1.50479   | -0.263976  | 1.52535  |  0.729823 |  0.737169 | -0.240717 |
| 503 |  0.089901 | 2.00564  | -1.13093   | -0.942879  | 0.544493 | -1.64931  | -0.119709 | -0.125324 |
| 504 |  2.67342  | 0.110068 | -0.0911749 | -0.154845  | 0.265834 | -0.959033 |  1.61703  | -2.49404  |
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cap6_pipe.html" class="btn btn-neutral float-left" title="自定义pipe模块" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="cap8_deploy.html" class="btn btn-neutral float-right" title="生产部署" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2023, zhulei227.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>